# Claude Code Hooks Configuration
# Claude Codeé’©å­é…ç½®

[[hooks]]
event = "PreToolUse"
[hooks.matcher]
tool_name = "git_commit"
command = """
echo "ğŸ” Running automated quality checks... æ­£åœ¨è¿è¡Œè‡ªåŠ¨åŒ–è´¨é‡æ£€æŸ¥..."

# 1. Check if required files exist æ£€æŸ¥å¿…éœ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "package.json" ] && [ ! -f "requirements.txt" ] && [ ! -f "Cargo.toml" ]; then
    echo "â„¹ï¸  No package manager files found, skipping dependency checks"
    echo "â„¹ï¸  æœªæ‰¾åˆ°åŒ…ç®¡ç†å™¨æ–‡ä»¶ï¼Œè·³è¿‡ä¾èµ–æ£€æŸ¥"
else
    echo "âœ… Package configuration files found æ‰¾åˆ°åŒ…é…ç½®æ–‡ä»¶"
fi

# 2. Run test suite if available è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰
if [ -f "package.json" ]; then
    if npm list --depth=0 2>/dev/null | grep -q "jest\|vitest\|mocha"; then
        echo "ğŸ§ª Running tests... è¿è¡Œæµ‹è¯•..."
        npm test || (echo "âŒ Tests failed æµ‹è¯•å¤±è´¥" && exit 1)
    else
        echo "â„¹ï¸  No test framework detected, skipping tests"
    fi
elif [ -f "requirements.txt" ]; then
    if [ -f "pytest.ini" ] || [ -f "setup.cfg" ] || find . -name "test_*.py" -o -name "*_test.py" | head -1 | grep -q .; then
        echo "ğŸ§ª Running Python tests... è¿è¡ŒPythonæµ‹è¯•..."
        python -m pytest || (echo "âŒ Tests failed æµ‹è¯•å¤±è´¥" && exit 1)
    else
        echo "â„¹ï¸  No Python tests detected, skipping tests"
    fi
fi

# 3. Code quality check ä»£ç è´¨é‡æ£€æŸ¥
if [ -f "package.json" ]; then
    if npm list --depth=0 2>/dev/null | grep -q "eslint"; then
        echo "ğŸ” Running ESLint... è¿è¡ŒESLint..."
        npm run lint || echo "âš ï¸  Linting issues found (non-blocking) å‘ç°ä»£ç é£æ ¼é—®é¢˜ï¼ˆéé˜»å¡ï¼‰"
    fi

    if npm list --depth=0 2>/dev/null | grep -q "typescript"; then
        echo "ğŸ” Running TypeScript checks... è¿è¡ŒTypeScriptæ£€æŸ¥..."
        npx tsc --noEmit || echo "âš ï¸  Type check issues found (non-blocking) å‘ç°ç±»å‹æ£€æŸ¥é—®é¢˜ï¼ˆéé˜»å¡ï¼‰"
    fi
fi

# 4. Documentation consistency validation æ–‡æ¡£ä¸€è‡´æ€§éªŒè¯
if [ -f "scripts/validate-docs.sh" ]; then
    echo "ğŸ“š Validating documentation... éªŒè¯æ–‡æ¡£..."
    bash scripts/validate-docs.sh || echo "âš ï¸  Documentation validation warnings æ–‡æ¡£éªŒè¯è­¦å‘Š"
fi

# 5. Security scan å®‰å…¨æ‰«æ
if [ -f "package.json" ]; then
    echo "ğŸ”’ Running security audit... è¿è¡Œå®‰å…¨å®¡è®¡..."
    npm audit --audit-level=high || echo "âš ï¸  Security audit warnings å®‰å…¨å®¡è®¡è­¦å‘Š"
fi

echo "âœ… Quality checks completed è´¨é‡æ£€æŸ¥å®Œæˆ"
"""

[[hooks]]
event = "PostToolUse"
[hooks.matcher]
tool_name = "git_commit"
command = """
echo "ğŸš€ Post-commit automation... æäº¤åè‡ªåŠ¨åŒ–..."

# Get commit message for notifications è·å–æäº¤ä¿¡æ¯ç”¨äºé€šçŸ¥
COMMIT_MSG=$(git log -1 --pretty=%B)

# Trigger CI/CD pipeline if available è§¦å‘CI/CDæµæ°´çº¿ï¼ˆå¦‚æœå¯ç”¨ï¼‰
if command -v gh >/dev/null 2>&1; then
    echo "ğŸ”„ Checking for GitHub Actions workflows... æ£€æŸ¥GitHub Actionså·¥ä½œæµ..."
    if [ -f ".github/workflows/ci.yml" ]; then
        echo "ğŸš€ CI/CD pipeline will be triggered automatically"
        echo "ğŸš€ CI/CDæµæ°´çº¿å°†è‡ªåŠ¨è§¦å‘"
    fi
fi

# Update documentation versions if needed å¦‚æœéœ€è¦ï¼Œæ›´æ–°æ–‡æ¡£ç‰ˆæœ¬
if [ -f "scripts/update-doc-versions.sh" ]; then
    echo "ğŸ“š Updating documentation versions... æ›´æ–°æ–‡æ¡£ç‰ˆæœ¬..."
    bash scripts/update-doc-versions.sh
fi

echo "âœ… Post-commit automation completed æäº¤åè‡ªåŠ¨åŒ–å®Œæˆ"
"""

[[hooks]]
event = "PreToolUse"
[hooks.matcher]
tool_name = "Edit"
command = """
echo "ğŸ“ Pre-edit validation... ç¼–è¾‘å‰éªŒè¯..."

# Check if editing critical configuration files æ£€æŸ¥æ˜¯å¦åœ¨ç¼–è¾‘å…³é”®é…ç½®æ–‡ä»¶
if echo "$CLAUDE_TOOL_PARAMS" | grep -q -E "(package\.json|requirements\.txt|Cargo\.toml|\.env)"; then
    echo "âš ï¸  Editing critical configuration file - please ensure changes are documented"
    echo "âš ï¸  æ­£åœ¨ç¼–è¾‘å…³é”®é…ç½®æ–‡ä»¶ - è¯·ç¡®ä¿å˜æ›´å·²è®°å½•åœ¨æ–‡æ¡£ä¸­"
fi
"""

[[hooks]]
event = "PreToolUse"
[hooks.matcher]
tool_name = "Write"
command = """
echo "ğŸ“„ Pre-write validation... å†™å…¥å‰éªŒè¯..."

# Check if creating new files in important directories æ£€æŸ¥æ˜¯å¦åœ¨é‡è¦ç›®å½•ä¸­åˆ›å»ºæ–°æ–‡ä»¶
if echo "$CLAUDE_TOOL_PARAMS" | grep -q -E "(src/|lib/|tests?/|docs/)"; then
    echo "â„¹ï¸  Creating file in important directory - consider updating documentation"
    echo "â„¹ï¸  åœ¨é‡è¦ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ - è¯·è€ƒè™‘æ›´æ–°ç›¸å…³æ–‡æ¡£"
fi
"""